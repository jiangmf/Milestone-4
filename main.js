var songs = {
	1: {
	    artist: "Daniel Caesar",
	    title: "Who Hurt You?",
	    album: "Who Hurt You? - Single",
	    duration: 231
	  },
	2: {
	    artist: "Summer Walker",
	    title: "Session 32",
	    album: "Session 32 - Single",
	    duration: 98
	  },
	3: {
	    artist: "Khalid",
	    title: "Saturday Nights",
	    album: "Suncity",
	    duration: 209
	  },
	4: {
	    artist: "Ella Mai",
	    title: "Everything (feat. John Legend)",
	    album: "Ella Mai",
	    duration: 181
	  },
	5: {
	    artist: "Ari Lennox",
	    title: "Grampa",
	    album: "Grampa - Single",
	    duration: 232
	  },
	6: {
	    artist: "Teyana Taylor",
	    title: "Issues / Hold On",
	    album: "K.T.S.E.",
	    duration: 185
	  },
	7: {
	    artist: "Andra Day",
	    title: "Amen",
	    album: "Amen - Single",
	    duration: 183
	  },
	8: {
	    artist: "Jessie Reyez",
	    title: "Apple Juice",
	    album: "Being Human In Public",
	    duration: 180
	  },
	9: {
	    artist: "H.E.R.",
	    title: "Could've Been (feat. Bryson Tiller)",
	    album: "I Used to Know Her: The Prelude - EP",
	    duration: 248
	  },
	10: {
	    artist: "Alina Baraz",
	    title: "Fallin",
	    album: "The Color of You",
	    duration: 246
	  },
	11: {
	    artist: "Free Nationals",
	    title: "Beauty & Essex (feat. Daniel Caesar & Unknown Mortal Orchestra)",
	    album: "Beauty & Essex (feat. Daniel Caesar & Unknown Mortal Orchestra) - Single",
	    duration: 277
	  },
	12: {
	    artist: "Sabrina Claudio",
	    title: "Messages From Her",
	    album: "Messages From Her - Single",
	    duration: 290
	  },
	13: {
	    artist: "LOONY",
	    title: "A Small Flame",
	    album: "A Small Flame - Single",
	    duration: 229
	  },
	14: {
	    artist: "Queen Naija",
	    title: "Butterflies",
	    album: "Queen Naija - EP",
	    duration: 212
	  },
	15: {
	    artist: "Jorja Smith",
	    title: "February 3rd",
	    album: "Lost & Found",
	    duration: 242
	  },
	16: {
	    artist: "Ryland James",
	    title: "Good to You",
	    album: "Good to You - Single",
	    duration: 189
	  },
	17: {
	    artist: "Corinne Bailey Rae",
	    title: "Like a Star",
	    album: "Corinne Bailey Rae",
	    duration: 243
	  },
	18: {
	    artist: "The Weeknd",
	    title: "Call Out My Name",
	    album: "My Dear Melancholy,",
	    duration: 228
	  },
	19: {
	    artist: "Sabrina Claudio",
	    title: "Frozen",
	    album: "About Time",
	    duration: 244
	  },
	20: {
	    artist: "Eloise",
	    title: "You, Dear",
	    album: "You, Dear - Single",
	    duration: 187
	  },
	21: {
	    artist: "Leon Bridges",
	    title: "Beyond",
	    album: "Good Thing",
	    duration: 240
	  },
	22: {
	    artist: "Omar Apollo",
	    title: "Erase",
	    album: "Stereo",
	    duration: 236
	  },
	23: {
	    artist: "Justin Timberlake",
	    title: "Morning Light (feat. Alicia Keys)",
	    album: "Man of the Woods",
	    duration: 243
	  },
	24: {
	    artist: "Charlotte Day Wilson",
	    title: "Doubt",
	    album: "Doubt - Single",
	    duration: 257
	  },
	25: {
	    artist: "Alicia Keys",
	    title: "If I Ain't Got You",
	    album: "The Diary of Alicia Keys",
	    duration: 228
	  },
	26: {
	    artist: "Grace",
	    title: "Boyfriend Jeans",
	    album: "Boyfriend Jeans - Single",
	    duration: 202
	  },
	27: {
	    artist: "Khalid",
	    title: "Stay",
	    album: "Uncle Drew (Original Motion Picture Soundtrack)",
	    duration: 204
	  },
	28: {
	    artist: "H.E.R.",
	    title: "Focus",
	    album: "H.E.R.",
	    duration: 200
	  },
	29: {
	    artist: "YEBBA",
	    title: "Evergreen",
	    album: "Evergreen - Single",
	    duration: 192
	  },
	30: {
	    artist: "lemin.",
	    title: "My Body",
	    album: "My Body - Single",
	    duration: 207
	  },
	31: {
	    artist: "Ella Mai",
	    title: "Naked",
	    album: "Naked - Single",
	    duration: 197
	  },
	32: {
	    artist: "KIRBY",
	    title: "Vain",
	    album: "Vain - Single",
	    duration: 245
	  },
	33: {
	    artist: "Kehlani",
	    title: "Again",
	    album: "Again - Single",
	    duration: 220
	  },
	34: {
	    artist: "Daniel Caesar",
	    title: "Blessed",
	    album: "Freudian",
	    duration: 241
	  },
	35: {
	    artist: "JOY.",
	    title: "Change",
	    album: "Six",
	    duration: 222
	  },
	36: {
	    artist: "Jorja Smith",
	    title: "Beautiful Little Fools",
	    album: "Beautiful Little Fools - Single",
	    duration: 216
	  },
	37: {
	    artist: "Brent Faiyaz",
	    title: "Talk 2 U",
	    album: "Sonder Son",
	    duration: 159
	  },
	38: {
	    artist: "Leon Bridges",
	    title: "Bet Ain't Worth the Hand",
	    album: "Good Thing",
	    duration: 185
	  },
	39: {
	    artist: "Sade",
	    title: "By Your Side",
	    album: "Lovers Rock",
	    duration: 274
	  },
	40: {
	    artist: "dvsn",
	    title: "Mood",
	    album: "Morning After",
	    duration: 215
	  },
	41: {
	    artist: "Kehlani",
	    title: "Honey",
	    album: "Honey - Single",
	    duration: 199
	  },
	42: {
	    artist: "Sampha",
	    title: "(No One Knows Me) Like the Piano",
	    album: "Process",
	    duration: 218
	  },
	43: {
	    artist: "ODIE",
	    title: "Little Lies",
	    album: "Analogue",
	    duration: 220
	  },
	44: {
	    artist: "Bruno Mars",
	    title: "When I Was Your Man",
	    album: "Unorthodox Jukebox",
	    duration: 213
	  },
	45: {
	    artist: "Charlotte Day Wilson",
	    title: "Find You",
	    album: "CDW - EP",
	    duration: 303
	  },
	46: {
	    artist: "Daniel Caesar",
	    title: "Get You (feat. Kali Uchis)",
	    album: "Freudian",
	    duration: 278
	  },
	47: {
	    artist: "Lauryn Hill",
	    title: "Nothing Even Matters (feat. D'Angelo)",
	    album: "The Miseducation of Lauryn Hill",
	    duration: 350
	  },
	48: {
	    artist: "Lou Val",
	    title: "The Earth Stood Still",
	    album: "Lonely In Paradise",
	    duration: 194
	  },
	49: {
	    artist: "SiR",
	    title: "Summer in November",
	    album: "November",
	    duration: 229
	  },
	50: {
	    artist: "H.E.R.",
	    title: "My Song",
	    album: "My Song - Single",
	    duration: 350
	  },
	51: {
	    artist: "Jessie Reyez",
	    title: "Figures, a Reprise (feat. Daniel Caesar)",
	    album: "Figures, a Reprise (feat. Daniel Caesar) - Single",
	    duration: 192
	  },
	52: {
	    artist: "Ne-Yo",
	    title: "GOOD MAN",
	    album: "GOOD MAN (Deluxe)",
	    duration: 229
	  },
	53: {
	    artist: "Sean Leon",
	    title: "90 BPM",
	    album: "90 BPM - Single",
	    duration: 149
	  },
	54: {
	    artist: "Andra Day",
	    title: "Rise Up",
	    album: "Cheers to the Fall",
	    duration: 253
	  },
	55: {
	    artist: "Rihanna",
	    title: "Stay (feat. Mikky Ekko)",
	    album: "Unapologetic (Deluxe Version)",
	    duration: 240
	  },
	56: {
	    artist: "Childish Gambino",
	    title: "Redbone",
	    album: "Awaken, My Love!",
	    duration: 326
	  },
	57: {
	    artist: "PARTYNEXTDOOR",
	    title: "The Right Way",
	    album: "Seven Days",
	    duration: 281
	  },
	58: {
	    artist: "D%u2019Angelo and The Vanguard",
	    title: "Really Love",
	    album: "Black Messiah",
	    duration: 344
	  },
	59: {
	    artist: "Lily Moore",
	    title: "Not That Special",
	    album: "Not That Special - Single",
	    duration: 219
	  },
	60: {
	    artist: "The Weeknd",
	    title: "True Colors",
	    album: "Starboy",
	    duration: 206
	  },
};

var playlists = {
  'Study': {
    name: 'Study',
    songs: [1, 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,27,30,34,48]
  },
  'Gym': {
    name: 'Gym',
    songs: [2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50]
  },
  'Relax': {
    name: 'Relax',
    songs: [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59]
  }
}

var activePlaylist = Object.keys(playlists)[0];
var isPlaying = false;
var progressVal = 0;
var intervalTimer;


$("html").on("click", ".fas.fa-play", function() {
  $(this).addClass("hidden");
  $(".fas.fa-pause").removeClass("hidden");
  progressVal = +$("#progressbar").val();
	clearInterval(intervalTimer);
  intervalTimer = setInterval(bar, 1000);
  isPlaying = true;
  function bar(){
    if(isPlaying){
      if (progressVal == + $("#progressbar").attr('max')){
				$(".fa-step-forward").click();
      }else{
        progressVal++;
        $("#progressbar").val(progressVal).trigger('input');
      }
    }
  }
})
$("html").on("click", ".fas.fa-pause", function() {
  $(this).addClass("hidden");
  $(".fas.fa-play").removeClass("hidden");
  isPlaying = false;
})

$("html").on('click', '#playlistList div', function() {
  var id = $(this).attr('id');
  showPlaylist(id)
  activePlaylist = id;
  $("#playlistList div").removeClass('active');
  $(this).addClass('active');

});

$("html").on('click', '#nav-bar h2', function() {
  var id = $(this).attr('data-id');
  $("#nav-bar h2").removeClass('active');
  $(this).addClass('active');
  $("[id$='Window']").addClass('hidden');
  $("#" + id + "Window").removeClass('hidden');
});

$("html").on('click', '.songList tbody tr', function() {
  $(".songList tr").removeClass('active');
  $(this).addClass('active');
  var tableVal = []
  $(this).find('td').each(function(i) {
    tableVal.push($(this).text());
  })

  $("#songname").html(tableVal[0]);
  $("#artistname").html(tableVal[1]);

  $("#progress-right").html(tableVal[3]);
  var time = tableVal[3].split(":");
  var seconds = (+time[0] * 60) + (+time[1]);

  $("#progressbar").attr("max", seconds);
	$("#progressbar").val('0');
  var currenttime = convertDuration($("#progressbar").val());
  $("#progress-left").html(currenttime[0] + ":" + currenttime[1].toString().padStart(2, '0'));

	$("#albumart").html(`<img src='https://picsum.photos/200/200/?image=${$(this).attr('data-id')}'/>`);
	progressVal = 0;
});

$("html").on('input', '#progressbar', function() {
	var currenttime = convertDuration($(this).val());
	$("#progress-left").html(currenttime[0] + ":" + currenttime[1].toString().padStart(2, '0'));
	progressVal = +$(this).val();
});

$("html").on('click', '.fa-random, .fa-redo-alt', function(){
  $(this).toggleClass("toggle")
});

$("html").on('click', '.fa-step-backward', function(){
  if ($(".fa-redo-alt").hasClass("toggle")){
    $("tr.active:visible").click();
  }else if($(".fa-random").hasClass("toggle")){
    var random = Math.floor( (Math.random() * $('tbody tr:visible').length) + 1 )
    $("tbody tr:visible").eq(random).click();
  }else{
    $("tr.active:visible").prev("tr").click();
  }
})

$("html").on('click', '.fa-step-forward', function(){
  if ($(".fa-redo-alt").hasClass("toggle")){
    $("tr.active:visible").click();
  }else if($(".fa-random").hasClass("toggle")){
    var random = Math.floor( (Math.random() * $('tbody tr:visible').length) + 1 )
    $("tbody tr:visible").eq(random).click();
  }else{
    $("tr.active:visible").next("tr").click();

  }
})

$(function() {
  $("#add").on('click', function() {
    newPlaylist()
  })
  playlistSidebar();
  $("#" + activePlaylist).click();
  showLibrary();
});

function playlistSidebar() {
	$("#playlistList").html("");
  for (index in playlists) {
    var playlistName = playlists[index].name;
		var playlistSongs = playlists[index].songs.length;
    var name = $('<div ondrop="drop(event)" ondragover="allowDrop(event)"><p>' + playlistName + "<span>" + playlistSongs + " Songs</span></p></div>").attr("id", playlistName);
    if (playlistName == activePlaylist) {
      name.addClass('active');
    }
    $("#playlistList").append(name);
  }
}

function showPlaylist(playlist) {
  var key = playlist;
  var playlistName = "<h3 style='margin-top: 0; margin-bottom: 10px'>" + playlist + "</h3>";
  var numSongs = "<p style='margin-bottom: 10px'>" + playlists[key].songs.length + " Songs</p>";
  var durationLength = 0;
  for (i in playlists[key].songs) {
    var id = playlists[key].songs[i]
    durationLength = durationLength + songs[id].duration;
  }
  var durationVal = convertDuration(durationLength);
  var duration = "<p>" + durationVal[0] + " minutes " + durationVal[1] + " seconds</p>";
  var playlistArt = `<img style="float:left; margin-right: 20px; margin-bottom: 10px;" src='https://picsum.photos/100/100/?image=${playlists[key].songs[0]}'/>`;
  $("#playlistHeader").html(playlistArt + playlistName + numSongs + duration);
  var table = $("<table></table>").attr("class", "songList");

  var html = `
	<thead><tr><th>Title</th>
	<th>Artist</th>
	<th>Album</th>
	<th>Duration</th></tr></thead><tbody>`

  var playlistSongs = playlists[key];
  for (song in playlistSongs['songs']) {
    var duration = 0;
    var id = playlistSongs['songs'][song];
    duration = convertDuration(songs[id]["duration"]);
    html += `
			<tr data-id=${id} draggable="true" ondragstart="drag(event)"><td><span>${songs[id]["title"]}</span></td>
			<td><span>${songs[id]["artist"]}</span></td>
			<td><span>${songs[id]["album"]}</span></td>
			<td><span>${duration[0] + ":" + duration[1].toString().padStart(2,'0')}</span></td></tr>
			`
  }
  html += "</tbody>";
  table.html(html);
  $("#playlistWindow .songTable").html(table);
  $('.songList').dataTable({
		autoWidth: false,
    paging: false,
    searching: false,
    bInfo: false,
    destroy: true,
    "language": {
      "emptyTable": "There are no songs in this playlist."
    },
    "columns": [{
        "width": "35%"
      },
      {
        "width": "25%"
      },
      {
        "width": "25%"
      },
      {
        "width": "15%"
      },
    ]
  });
}

function showLibrary() {
  var table = $("<table></table>").attr("class", "songList");

  var html = `
	<thead><tr><th>Title</th>
	<th>Artist</th>
	<th>Album</th>
	<th>Duration</th></tr></thead><tbody>`

  for (song in songs) {
    var duration = 0;
    var id = song;
    duration = convertDuration(songs[id]["duration"]);

    html += `
			<tr data-id=${id} draggable="true" ondragstart="drag(event)"><td><span>${songs[id]["title"]}</span></td>
			<td><span>${songs[id]["artist"]}</span></td>
			<td><span>${songs[id]["album"]}</span></td>
			<td><span>${duration[0] + ":" + duration[1].toString().padStart(2,'0')}</span></td></tr>
			`
  }
  html += "</tbody>";
  table.html(html);
  $("#libraryWindow .songTable").html(table);
  $('#libraryWindow .songTable .songList').dataTable({
		autoWidth: false,
    paging: false,
    searching: false,
    bInfo: false,
    destroy: true,
    "language": {
      "emptyTable": "There are no songs in your library."
    },
    "columns": [{
        "width": "35%"
      },
      {
        "width": "25%"
      },
      {
        "width": "25%"
      },
      {
        "width": "15%"
      },
    ]
  });
}

function convertDuration(duration) {
  var minutes = parseInt(duration / 60);
  var seconds = duration % 60;
  return [minutes, seconds]
}

function newPlaylist() {
  $("#playlistList").html("");
  var name = prompt("Enter Playlist name:", "Playlist");
  var value = {
    name: name,
    songs: []
  }
  playlists[name] = value;
  playlistSidebar();
}

function allowDrop(ev) {
    ev.preventDefault();
}

function drag(ev) {
    ev.dataTransfer.setData("songid", ev.target.getAttribute('data-id'));
}

function drop(ev) {
    ev.preventDefault();
		var id = ev.dataTransfer.getData('songid');
		var playlist = $(ev.target).closest("div").attr("id");
		playlists[playlist].songs.push(+id);
		playlists[playlist].songs = [...new Set(playlists[playlist].songs)]
		playlistSidebar();
		if(activePlaylist == playlist){
		showPlaylist(playlist);
		}
}
